<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Travel History</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<div class="container">
    <h2>Your Travel History</h2>
    <form id="historyForm">
        <label>User ID:</label>
        <input type="number" id="userId" required>
        <button type="submit">View History</button>
    </form>
    <table id="historyTable" style="margin-top:20px; display:none;">
        <thead>
            <tr>
                <th>Booking ID</th>
                <th>Pickup</th>
                <th>Destination</th>
                <th>Date</th>
                <th>Cab Type</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <p id="historyMsg"></p>
</div>
<script src="/js/ui.js"></script>
<script>
// UI niceties
document.addEventListener('DOMContentLoaded', ()=>{
    const storedUserId = localStorage.getItem('userId'); if (storedUserId) document.getElementById('userId').value = storedUserId;
});

//
// auto-fill userId from localStorage
const storedUserId = localStorage.getItem('userId');
if (storedUserId) document.getElementById('userId').value = storedUserId;

document.getElementById("historyForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const userId = document.getElementById("userId").value;
    const res = await fetch(`/api/bookings/user/${userId}`);
    const table = document.getElementById("historyTable");
    const msg = document.getElementById("historyMsg");
    if (res.ok) {
        const bookings = await res.json();
        const tbody = table.querySelector("tbody");
        tbody.innerHTML = "";
        function fmt(dt) {
            if (!dt) return '';
            try {
                const d = new Date(dt);
                return d.toLocaleString();
            } catch (e) { return dt; }
        }
        bookings.forEach(b => {
            tbody.innerHTML += `<tr><td>${b.id}</td><td>${b.fromLocation || ''}</td><td>${b.toLocation || ''}</td><td>${fmt(b.dateTime)}</td><td>${b.transportType || ''}</td></tr>`;
        });
        table.style.display = bookings.length ? "table" : "none";
        msg.textContent = bookings.length ? "" : "No bookings found.";
    } else {
        table.style.display = "none";
        msg.textContent = await res.text();
    }
});
</script>
</body>
</html>
