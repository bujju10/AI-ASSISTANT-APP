<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book a Cab</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<div class="container">
    <h2>Book a Cab</h2>
    <form id="cabForm">
        <label>User ID:</label><br>
        <input type="number" id="userId" required><br>
        <label>Pickup Location:</label><br>
        <input type="text" id="pickup" required><br>
        <label>Destination:</label><br>
        <input type="text" id="destination" required><br>
        <label>Date:</label><br>
        <input type="date" id="travelDate" required><br>
        <label>Cab Type:</label><br>
        <select id="cabType">
            <option value="Sedan">Sedan</option>
            <option value="SUV">SUV</option>
            <option value="Mini">Mini</option>
        </select><br><br>
        <button type="submit">Book Cab</button>
    </form>
    <p id="cabMsg"></p>
</div>
<script src="/js/ui.js"></script>
<script>
// auto-fill userId from localStorage if available
const storedUserId = localStorage.getItem('userId');
if (storedUserId) document.getElementById('userId').value = storedUserId;

document.getElementById("cabForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const booking = {
        pickup: document.getElementById("pickup").value,
        destination: document.getElementById("destination").value,
        travelDate: document.getElementById("travelDate").value,
        cabType: document.getElementById("cabType").value
    };
    const userId = document.getElementById("userId").value;
    const res = await fetch(`/api/bookings?userId=${userId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(booking)
    });
    if (res.ok) {
        const saved = await res.json();
        uiToast('Booking confirmed (ID: '+saved.id+')','success');
        document.getElementById("cabMsg").innerHTML = `Booked ✓ (ID: ${saved.id}) — <a href="/history.html">View history</a>`;
    } else {
        const err = await res.text();
        uiToast('Booking failed: '+err,'error');
        document.getElementById("cabMsg").textContent = 'Error: ' + err;
    }
});
</script>
</body>
</html>
